<ngx-loading [show]="loading"></ngx-loading>
<app-header></app-header>

<br><br>
<div class="container-fluid mt-3" [hidden]="modalUpload">

    <div class="row mb-3">
        <div class="col-8">
            <div>
                <strong>Data Rebate</strong>
            </div>
        </div>

        <div class="col-4 text-right">
            <a href="javascript:;" (click)="modalUpload = true;" class="btn btn-sm btn-outline-secondary"><small> <img src="./assets/icon/upload-cloud.svg" width="20"> Upload Data</small></a>
        </div>

    </div>

    <div class="row">

        <div class="col-12">
            <table id="ha" class="display excel" style="width:100%">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>User ID</th>
                        <th>Name</th>
                        <th class="text-right">Total Profit</th>
                        <th> Action </th>
                    </tr>
                </thead>
                <tbody>

                    <tr *ngFor="let x of items; let i = index">
                        <td>{{ i+1}}</td>
                        <td><code>{{x.id }}</code></td>
                        <td>{{ x.name}}</td>
                        <td class="text-right">Rp {{x.amount | number}}</td>
                        <td>
                            <button type="button" [routerLink]="[ '/rebateManual/detail', x.id ]" class="btn btn-sm py-0 btn-primary mx-1">Detail</button>
                        </td>

                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<!--  -->

<div class="container my-3" [hidden]="!modalUpload" >
    <div class="row">
        <div class="col-12">
            <div class="border py-1 px-2 bg-light shadow-sm">


                <div>
                    <strong>Insert Rebate</strong>
                    <button type="button" class="close" aria-label="Close" (click)="modalUpload = false">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div [innerHTML]="uploadError"></div>

                <div>

                    <table id="upld" class="display excel border" style="width:100%">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>ID</th>
                                <th>Name</th>
                                <th class="text-right">Amount IDR</th>
                                <th>PDF</th>
                                <th>Upload</th>
                                <th>Update</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let x of user; let i= index">
                                <td> {{i+1}} </td>
                                <td> <code>{{x.id}}</code> </td>
                                <td> <b>{{x.name}}</b> </td> 
                                <td>
                                    <input type="number" class="form-control form-control-sm text-right" [(ngModel)]="x.amount" (change)="updateEditable(x)">
                                

                                </td>
                                <td> 
                                    <div [hidden]="!x.urlDetail"><a href="{{api}}{{x.urlDetail}}" target="_blank">See PDF</a></div>
                                    <div class="up{{x.id}}"></div>
                                </td>
                                <td> 
                                     <button class="btn btn-sm btn-secondary py-0" (click)="open(content,x )">Upload</button>
                                  
                                </td>

                                <td> {{x.admin}}, {{x.update_date | date}} </td>
                            </tr>
                        </tbody>
                    </table>
                </div>


                <div class=" py-2">
                    
                    <div class="row no-gutters">
                        <div class="col-2 text-right">
                            Period Start:
                        </div>
                        <div class="col-2">
                            <input type="date" [(ngModel)]="periodDate">
                        </div>

                        <div class="col-2 text-right">
                            Period End:
                        </div>
                        <div class="col-2">
                            <input type="date" [(ngModel)]="periodDateEnd">
                        </div>

                        <div class="col-4 text-right">
                            <button type="button" class="btn btn-dark mx-2" (click)="onSubmitProfit();" [disabled]="!periodDate && !periodDateEnd ">Submit</button>
                        </div>
    
                    </div>


                  
                </div>

            </div>

        </div>
    </div>
</div>


<ng-template #content let-modal>
    <div class="modal-header">
      <b>Upload PDF</b>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <table class="table table-sm border">
            <tr>
                <td width="20%">ID </td><td>: <code>{{obj.id}}</code></td>
            </tr>
            <tr>
                <td>Name </td><td>: {{obj.name}}</td>
            </tr>
        </table>
        <input class="border p-1" id="fileId" type="file" (change)="onFileSelected($event)">
        <a href="javacsript:;" class="mx-1 btn btn-primary"   (click)="onUploadId();">Upload</a>
    </div>
    
  </ng-template>